#@ load("@ytt:overlay", "overlay")
#@overlay/match by=overlay.subset({"kind":"KubeadmControlPlane"})
---
apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
kind: KubeadmControlPlane
spec:
  kubeadmConfigSpec:
    files:
    #@overlay/append
    - content: |
        -----BEGIN CERTIFICATE-----
        <CA CERTIFICATE>
        -----END CERTIFICATE-----
      owner: root:root
      path: /etc/ssl/certs/internal-ca.pem
    preKubeadmCommands:
    #! Download and run Harbor config script
    #@overlay/append
    - /usr/bin/rehash_ca_certificates.sh

